
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Transfer Learning and Fine-tuning &#8212; Application of AI</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/06_transfer_learning';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="07 - Computer Vision Tasks: Theory and Concepts" href="07_cv_tasks_theory.html" />
    <link rel="prev" title="CNN Theory and Implementation with Keras" href="05_cnn_theory_keras.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
  
    <p class="title logo__title">Application of AI</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Application of AI
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Part 1 – Computer Vision</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="01_cv_applications.html">01 - Computer Vision Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="02_what_is_an_image.html">02 - What is an Image?</a></li>
<li class="toctree-l1"><a class="reference internal" href="03_intro_to_pillow.html">Introduction to Pillow &amp; Image Fundamentals</a></li>
<li class="toctree-l1"><a class="reference internal" href="04_intro_to_opencv.html">Introduction to OpenCV</a></li>
<li class="toctree-l1"><a class="reference internal" href="05_cnn_theory_keras.html">CNN Theory and Implementation with Keras</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Transfer Learning and Fine-tuning</a></li>
<li class="toctree-l1"><a class="reference internal" href="07_cv_tasks_theory.html">07 - Computer Vision Tasks: Theory and Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="07_intro_to_ultralytics.html">Introduction to Ultralytics YOLO</a></li>
<li class="toctree-l1"><a class="reference internal" href="07_object_detection_with_ultralytics.html">Object Detection with Ultralytics YOLO</a></li>
<li class="toctree-l1"><a class="reference internal" href="07b_segmentation_and_pose_with_ultralytics.html">Segmentation and Pose Estimation with Ultralytics YOLO</a></li>
<li class="toctree-l1"><a class="reference internal" href="07c_object_tracking_with_ultralytics.html">Object Tracking with Ultralytics YOLO</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Part 2 – AI Agents</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="08_ai_agents_intro.html">08 - Introduction to AI Agents</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/ezponda/ai-application-course-materials/blob/main/notebooks/06_transfer_learning.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>



<a href="https://github.com/ezponda/ai-application-course-materials" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/notebooks/06_transfer_learning.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Transfer Learning and Fine-tuning</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#table-of-contents">Table of Contents</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setup-and-data-preparation">Setup and Data Preparation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-the-flowers-dataset">Loading the Flowers Dataset</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-datasets">Creating Datasets</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dataset-performance-optimization">Dataset Performance Optimization</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-transfer-learning">What is Transfer Learning?</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-core-idea">The Core Idea</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#key-benefits">Key Benefits</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#when-does-transfer-learning-work">When Does Transfer Learning Work?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#two-main-strategies">Two Main Strategies</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pre-trained-models-in-keras">Pre-trained Models in Keras</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#available-models">Available Models</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mobilenetv2">MobileNetV2</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#imagenet-pre-training">ImageNet Pre-training</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-extraction-with-frozen-backbone">Feature Extraction with Frozen Backbone</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-the-pre-trained-model">Loading the Pre-trained Model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#freezing-the-backbone">Freezing the Backbone</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#understanding-model-specific-preprocessing">Understanding Model-Specific Preprocessing</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#building-the-transfer-learning-model">Building the Transfer Learning Model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#model-summary">Model Summary</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#training-the-model">Training the Model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-results">Visualizing Results</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#evaluating-performance">Evaluating Performance</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#making-predictions">Making Predictions</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#combining-custom-cnn-with-pre-trained-features">Combining Custom CNN with Pre-trained Features</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#building-a-hybrid-model">Building a Hybrid Model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#training-the-hybrid-model">Training the Hybrid Model</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fine-tuning">Fine-tuning</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#why-fine-tune">Why Fine-tune?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#risks-and-precautions">Risks and Precautions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#unfreezing-the-backbone">Unfreezing the Backbone</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#recompiling-with-lower-learning-rate">Recompiling with Lower Learning Rate</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fine-tuning-training">Fine-tuning Training</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-fine-tuning-results">Visualizing Fine-tuning Results</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#combined-training-curve">Combined Training Curve</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#comparing-approaches">Comparing Approaches</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#training-from-scratch-previous-notebook">Training from Scratch (Previous Notebook)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#transfer-learning-frozen">Transfer Learning (Frozen)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hybrid-model">Hybrid Model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Fine-tuning</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#comparison-table">Comparison Table</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#performance-summary">Performance Summary</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#recap">Recap</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="transfer-learning-and-fine-tuning">
<h1>Transfer Learning and Fine-tuning<a class="headerlink" href="#transfer-learning-and-fine-tuning" title="Link to this heading">#</a></h1>
<p>Transfer learning leverages knowledge from models pre-trained on large datasets to solve new tasks with less data and training time. Instead of training a CNN from scratch, we reuse learned features from models trained on millions of images, then adapt them to our specific problem. This approach often achieves better results with significantly less computational cost.</p>
<p>We will use pre-trained models from Keras Applications to classify flower images, demonstrating both feature extraction and fine-tuning strategies.</p>
<section id="table-of-contents">
<h2>Table of Contents<a class="headerlink" href="#table-of-contents" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p><a class="reference internal" href="#Setup-and-Data-Preparation"><span class="xref myst">Setup and Data Preparation</span></a></p></li>
<li><p><a class="reference internal" href="#What-is-Transfer-Learning?"><span class="xref myst">What is Transfer Learning?</span></a></p></li>
<li><p><a class="reference internal" href="#Pre-trained-Models-in-Keras"><span class="xref myst">Pre-trained Models in Keras</span></a></p></li>
<li><p><a class="reference internal" href="#Feature-Extraction-with-Frozen-Backbone"><span class="xref myst">Feature Extraction with Frozen Backbone</span></a></p></li>
<li><p><a class="reference internal" href="#Combining-Custom-CNN-with-Pre-trained-Features"><span class="xref myst">Combining Custom CNN with Pre-trained Features</span></a></p></li>
<li><p><a class="reference internal" href="#Fine-tuning"><span class="xref myst">Fine-tuning</span></a></p></li>
<li><p><a class="reference internal" href="#Comparing-Approaches"><span class="xref myst">Comparing Approaches</span></a></p></li>
<li><p><a class="reference internal" href="#Recap"><span class="xref myst">Recap</span></a></p></li>
</ol>
</section>
<section id="setup-and-data-preparation">
<h2>Setup and Data Preparation<a class="headerlink" href="#setup-and-data-preparation" title="Link to this heading">#</a></h2>
<p>First, let’s set up our environment and load the same flowers dataset we used previously.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">tensorflow</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">tf</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tensorflow</span><span class="w"> </span><span class="kn">import</span> <span class="n">keras</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tensorflow.keras</span><span class="w"> </span><span class="kn">import</span> <span class="n">layers</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pathlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="c1"># Set random seed for reproducibility</span>
<span class="n">tf</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">set_seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
</div>
<section id="loading-the-flowers-dataset">
<h3>Loading the Flowers Dataset<a class="headerlink" href="#loading-the-flowers-dataset" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Download dataset (~218MB)</span>
<span class="n">dataset_url</span> <span class="o">=</span> <span class="s1">&#39;https://storage.googleapis.com/download.tensorflow.org/example_images/flower_photos.tgz&#39;</span>
<span class="n">data_dir</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">get_file</span><span class="p">(</span><span class="s1">&#39;flower_photos&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="n">dataset_url</span><span class="p">,</span> <span class="n">untar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">data_dir</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">data_dir</span><span class="p">)</span>

<span class="c1"># Handle potential nested directory structure</span>
<span class="n">contents</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">data_dir</span><span class="p">)</span>
<span class="k">if</span> <span class="s1">&#39;flower_photos&#39;</span> <span class="ow">in</span> <span class="n">contents</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">data_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s1">&#39;flower_photos&#39;</span><span class="p">)</span>
    <span class="n">data_dir</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">data_dir</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Total images: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">data_dir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*/*.jpg&quot;</span><span class="p">)))</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="creating-datasets">
<h3>Creating Datasets<a class="headerlink" href="#creating-datasets" title="Link to this heading">#</a></h3>
<p>We use the same 96×96 image size and 80/20 train/validation split.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">image_size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">96</span><span class="p">,</span> <span class="mi">96</span><span class="p">)</span>
<span class="n">batch_size</span> <span class="o">=</span> <span class="mi">64</span>

<span class="c1"># Create training dataset (80% of data)</span>
<span class="n">train_ds</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">image_dataset_from_directory</span><span class="p">(</span>
    <span class="n">data_dir</span><span class="p">,</span>
    <span class="n">validation_split</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
    <span class="n">subset</span><span class="o">=</span><span class="s1">&#39;training&#39;</span><span class="p">,</span>
    <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
    <span class="n">image_size</span><span class="o">=</span><span class="n">image_size</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span>
<span class="p">)</span>

<span class="c1"># Create validation dataset (20% of data)</span>
<span class="n">val_ds</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">image_dataset_from_directory</span><span class="p">(</span>
    <span class="n">data_dir</span><span class="p">,</span>
    <span class="n">validation_split</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
    <span class="n">subset</span><span class="o">=</span><span class="s1">&#39;validation&#39;</span><span class="p">,</span>
    <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
    <span class="n">image_size</span><span class="o">=</span><span class="n">image_size</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span>
<span class="p">)</span>

<span class="n">class_names</span> <span class="o">=</span> <span class="n">train_ds</span><span class="o">.</span><span class="n">class_names</span>
<span class="n">num_classes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">class_names</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Classes: </span><span class="si">{</span><span class="n">class_names</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="dataset-performance-optimization">
<h3>Dataset Performance Optimization<a class="headerlink" href="#dataset-performance-optimization" title="Link to this heading">#</a></h3>
<p>Configure datasets for efficient training with caching and prefetching.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Optimize dataset performance - prevents GPU from waiting for data</span>
<span class="n">AUTOTUNE</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">AUTOTUNE</span>

<span class="n">train_ds</span> <span class="o">=</span> <span class="n">train_ds</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span><span class="o">.</span><span class="n">prefetch</span><span class="p">(</span><span class="n">buffer_size</span><span class="o">=</span><span class="n">AUTOTUNE</span><span class="p">)</span>
<span class="n">val_ds</span> <span class="o">=</span> <span class="n">val_ds</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span><span class="o">.</span><span class="n">prefetch</span><span class="p">(</span><span class="n">buffer_size</span><span class="o">=</span><span class="n">AUTOTUNE</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Dataset optimization applied&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="what-is-transfer-learning">
<h2>What is Transfer Learning?<a class="headerlink" href="#what-is-transfer-learning" title="Link to this heading">#</a></h2>
<p>Transfer learning is the practice of using knowledge learned from one task to improve performance on a related task.</p>
<section id="the-core-idea">
<h3>The Core Idea<a class="headerlink" href="#the-core-idea" title="Link to this heading">#</a></h3>
<p>Instead of training a CNN from scratch:</p>
<ol class="arabic simple">
<li><p><strong>Start with a pre-trained model</strong>: Trained on a large dataset (e.g., ImageNet with 1.4M images)</p></li>
<li><p><strong>Reuse learned features</strong>: Early layers detect edges, textures, shapes—useful for many vision tasks</p></li>
<li><p><strong>Adapt to new task</strong>: Replace or retrain only the final classification layers</p></li>
</ol>
</section>
<section id="key-benefits">
<h3>Key Benefits<a class="headerlink" href="#key-benefits" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p><strong>Less training data needed</strong>: Pre-trained features work well even with small datasets</p></li>
<li><p><strong>Faster training</strong>: Only train a small portion of the network</p></li>
<li><p><strong>Better performance</strong>: Often achieves higher accuracy than training from scratch</p></li>
<li><p><strong>Lower computational cost</strong>: No need for weeks of training on expensive GPUs</p></li>
</ul>
</section>
<section id="when-does-transfer-learning-work">
<h3>When Does Transfer Learning Work?<a class="headerlink" href="#when-does-transfer-learning-work" title="Link to this heading">#</a></h3>
<p>Transfer learning is most effective when:</p>
<ul class="simple">
<li><p><strong>Similar domains</strong>: Source and target tasks both involve images</p></li>
<li><p><strong>Related features</strong>: Low-level features (edges, textures) transfer well</p></li>
<li><p><strong>Limited target data</strong>: Small datasets benefit most from pre-trained knowledge</p></li>
</ul>
</section>
<section id="two-main-strategies">
<h3>Two Main Strategies<a class="headerlink" href="#two-main-strategies" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p><strong>Feature extraction</strong>: Freeze the pre-trained backbone, train only new layers</p></li>
<li><p><strong>Fine-tuning</strong>: Unfreeze some layers and train with a small learning rate</p></li>
</ol>
</section>
</section>
<section id="pre-trained-models-in-keras">
<h2>Pre-trained Models in Keras<a class="headerlink" href="#pre-trained-models-in-keras" title="Link to this heading">#</a></h2>
<p>Keras provides access to state-of-the-art CNN architectures pre-trained on ImageNet through <code class="docutils literal notranslate"><span class="pre">tf.keras.applications</span></code>.</p>
<section id="available-models">
<h3>Available Models<a class="headerlink" href="#available-models" title="Link to this heading">#</a></h3>
<p>Some popular options include:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Model</p></th>
<th class="head"><p>Parameters</p></th>
<th class="head"><p>Speed</p></th>
<th class="head"><p>Accuracy</p></th>
<th class="head"><p>Best For</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>MobileNetV2</p></td>
<td><p>3.5M</p></td>
<td><p>Fast</p></td>
<td><p>Good</p></td>
<td><p>Mobile/embedded devices</p></td>
</tr>
<tr class="row-odd"><td><p>EfficientNetB0</p></td>
<td><p>5.3M</p></td>
<td><p>Fast</p></td>
<td><p>Better</p></td>
<td><p>Balanced accuracy/speed</p></td>
</tr>
<tr class="row-even"><td><p>ResNet50</p></td>
<td><p>25.6M</p></td>
<td><p>Medium</p></td>
<td><p>High</p></td>
<td><p>When accuracy matters</p></td>
</tr>
<tr class="row-odd"><td><p>VGG16</p></td>
<td><p>138M</p></td>
<td><p>Slow</p></td>
<td><p>Good</p></td>
<td><p>Simple architecture</p></td>
</tr>
<tr class="row-even"><td><p>InceptionV3</p></td>
<td><p>23.9M</p></td>
<td><p>Medium</p></td>
<td><p>High</p></td>
<td><p>Multi-scale features</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="mobilenetv2">
<h3>MobileNetV2<a class="headerlink" href="#mobilenetv2" title="Link to this heading">#</a></h3>
<p>We’ll use <strong>MobileNetV2</strong> as our backbone:</p>
<ul class="simple">
<li><p>Designed for mobile and embedded devices</p></li>
<li><p>Excellent balance of accuracy and speed</p></li>
<li><p>Relatively few parameters (faster to fine-tune)</p></li>
<li><p>Pre-trained on ImageNet (1000 classes of everyday objects)</p></li>
</ul>
</section>
<section id="imagenet-pre-training">
<h3>ImageNet Pre-training<a class="headerlink" href="#imagenet-pre-training" title="Link to this heading">#</a></h3>
<p>ImageNet is a large visual database with:</p>
<ul class="simple">
<li><p>1.4 million training images</p></li>
<li><p>1000 classes (animals, plants, vehicles, objects)</p></li>
<li><p>Many natural images and outdoor scenes</p></li>
</ul>
<p>The learned features from ImageNet transfer well to many vision tasks, including flower classification.</p>
</section>
</section>
<section id="feature-extraction-with-frozen-backbone">
<h2>Feature Extraction with Frozen Backbone<a class="headerlink" href="#feature-extraction-with-frozen-backbone" title="Link to this heading">#</a></h2>
<p>The first transfer learning strategy is <strong>feature extraction</strong>: use the pre-trained model as a fixed feature extractor.</p>
<section id="loading-the-pre-trained-model">
<h3>Loading the Pre-trained Model<a class="headerlink" href="#loading-the-pre-trained-model" title="Link to this heading">#</a></h3>
<p>We load MobileNetV2 with ImageNet weights, excluding the top classification layer.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load MobileNetV2 without the classification head (include_top=False removes final Dense layer)</span>
<span class="n">base_model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">applications</span><span class="o">.</span><span class="n">MobileNetV2</span><span class="p">(</span>
    <span class="n">input_shape</span><span class="o">=</span><span class="n">image_size</span> <span class="o">+</span> <span class="p">(</span><span class="mi">3</span><span class="p">,),</span>
    <span class="n">include_top</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Exclude final classification layer</span>
    <span class="n">weights</span><span class="o">=</span><span class="s1">&#39;imagenet&#39;</span>  <span class="c1"># Use ImageNet pre-trained weights</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Base model layers: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">base_model</span><span class="o">.</span><span class="n">layers</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Base model output shape: </span><span class="si">{</span><span class="n">base_model</span><span class="o">.</span><span class="n">output_shape</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="freezing-the-backbone">
<h3>Freezing the Backbone<a class="headerlink" href="#freezing-the-backbone" title="Link to this heading">#</a></h3>
<p>We freeze the base model to prevent its weights from being updated during training. This preserves the learned ImageNet features.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Freeze the base model - prevents weights from updating during training</span>
<span class="n">base_model</span><span class="o">.</span><span class="n">trainable</span> <span class="o">=</span> <span class="kc">False</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Trainable weights before freezing: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">base_model</span><span class="o">.</span><span class="n">trainable_weights</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Non-trainable weights after freezing: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">base_model</span><span class="o">.</span><span class="n">non_trainable_weights</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="understanding-model-specific-preprocessing">
<h3>Understanding Model-Specific Preprocessing<a class="headerlink" href="#understanding-model-specific-preprocessing" title="Link to this heading">#</a></h3>
<p><strong>Critical:</strong> Each pre-trained model expects inputs preprocessed in a specific way. Using incorrect preprocessing will result in poor performance because the model was trained with specific input ranges and transformations.</p>
<p>Different models use different preprocessing strategies:</p>
<ul class="simple">
<li><p><strong>MobileNetV2</strong>: Scales pixel values from [0, 255] to [-1, 1] range</p></li>
<li><p><strong>ResNet/VGG</strong>: Subtracts ImageNet mean [103.939, 116.779, 123.68] from RGB channels</p></li>
<li><p><strong>EfficientNet</strong>: Scales to [0, 1] then normalizes with ImageNet statistics</p></li>
<li><p><strong>InceptionV3</strong>: Scales to [-1, 1] range</p></li>
</ul>
<p><strong>Always use the model’s preprocessing function</strong> (<code class="docutils literal notranslate"><span class="pre">tf.keras.applications.{model_name}.preprocess_input</span></code>) to ensure correct input format.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get MobileNetV2-specific preprocessing function</span>
<span class="n">preprocess_input</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">applications</span><span class="o">.</span><span class="n">mobilenet_v2</span><span class="o">.</span><span class="n">preprocess_input</span>

<span class="c1"># This function scales pixel values to [-1, 1] range (MobileNetV2&#39;s expected input)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="building-the-transfer-learning-model">
<h3>Building the Transfer Learning Model<a class="headerlink" href="#building-the-transfer-learning-model" title="Link to this heading">#</a></h3>
<p>We build a new model that:</p>
<ol class="arabic simple">
<li><p>Takes images as input</p></li>
<li><p>Preprocesses them for MobileNetV2</p></li>
<li><p>Passes through the frozen backbone (feature extraction)</p></li>
<li><p>Pools features to a single vector per channel</p></li>
<li><p>Classifies using new dense layers</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Build the transfer learning model using Functional API</span>
<span class="n">inputs</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">image_size</span> <span class="o">+</span> <span class="p">(</span><span class="mi">3</span><span class="p">,))</span>

<span class="c1"># Preprocessing: scale to [-1, 1] range expected by MobileNetV2</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">preprocess_input</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>

<span class="c1"># Pre-trained backbone (frozen): extract high-level features</span>
<span class="c1"># training=False keeps batch normalization layers in inference mode</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">base_model</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">training</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Classifier head: convert features to class predictions</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">layers</span><span class="o">.</span><span class="n">GlobalAveragePooling2D</span><span class="p">()(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># More efficient than Flatten, reduces parameters</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">layers</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># Regularization to prevent overfitting</span>
<span class="n">outputs</span> <span class="o">=</span> <span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">num_classes</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;softmax&#39;</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># Final classification</span>

<span class="n">model_transfer</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;transfer_learning_model&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="model-summary">
<h3>Model Summary<a class="headerlink" href="#model-summary" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_transfer</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>

<span class="c1"># Count trainable vs non-trainable parameters</span>
<span class="n">trainable_count</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">tf</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">model_transfer</span><span class="o">.</span><span class="n">trainable_weights</span><span class="p">])</span>
<span class="n">non_trainable_count</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">tf</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">model_transfer</span><span class="o">.</span><span class="n">non_trainable_weights</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Trainable parameters: </span><span class="si">{</span><span class="n">trainable_count</span><span class="si">:</span><span class="s1">,</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Non-trainable parameters: </span><span class="si">{</span><span class="n">non_trainable_count</span><span class="si">:</span><span class="s1">,</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Total parameters: </span><span class="si">{</span><span class="n">trainable_count</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">non_trainable_count</span><span class="si">:</span><span class="s1">,</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Observations:</strong></p>
<ul class="simple">
<li><p>Most parameters are frozen (non-trainable) - preserves ImageNet knowledge</p></li>
<li><p>Only the new classification layers are trainable - adapts to flower classes</p></li>
<li><p>Training will be fast since we update very few parameters</p></li>
</ul>
</section>
<section id="training-the-model">
<h3>Training the Model<a class="headerlink" href="#training-the-model" title="Link to this heading">#</a></h3>
<p>We compile and train with the frozen backbone.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_transfer</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
    <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span>  <span class="c1"># Default learning rate (1e-3) is fine for new layers</span>
    <span class="n">loss</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">SparseCategoricalCrossentropy</span><span class="p">(),</span>
    <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">epochs_initial</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">history_transfer</span> <span class="o">=</span> <span class="n">model_transfer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
    <span class="n">train_ds</span><span class="p">,</span>
    <span class="n">validation_data</span><span class="o">=</span><span class="n">val_ds</span><span class="p">,</span>
    <span class="n">epochs</span><span class="o">=</span><span class="n">epochs_initial</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="visualizing-results">
<h3>Visualizing Results<a class="headerlink" href="#visualizing-results" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="k">def</span><span class="w"> </span><span class="nf">plot_training_history</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Training History&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot training and validation metrics.&quot;&quot;&quot;</span>
    <span class="n">hist</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">)</span>
    <span class="n">hist</span><span class="p">[</span><span class="s1">&#39;epoch&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">history</span><span class="o">.</span><span class="n">epoch</span>

    <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

    <span class="c1"># Plot loss</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">hist</span><span class="p">[</span><span class="s1">&#39;epoch&#39;</span><span class="p">],</span> <span class="n">hist</span><span class="p">[</span><span class="s1">&#39;loss&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Train Loss&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">hist</span><span class="p">[</span><span class="s1">&#39;epoch&#39;</span><span class="p">],</span> <span class="n">hist</span><span class="p">[</span><span class="s1">&#39;val_loss&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Val Loss&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Epoch&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Loss&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s1"> - Loss&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="c1"># Plot accuracy</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">hist</span><span class="p">[</span><span class="s1">&#39;epoch&#39;</span><span class="p">],</span> <span class="n">hist</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Train Accuracy&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">hist</span><span class="p">[</span><span class="s1">&#39;epoch&#39;</span><span class="p">],</span> <span class="n">hist</span><span class="p">[</span><span class="s1">&#39;val_accuracy&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Val Accuracy&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Epoch&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Accuracy&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s1"> - Accuracy&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plot_training_history</span><span class="p">(</span><span class="n">history_transfer</span><span class="p">,</span> <span class="s1">&#39;Transfer Learning (Frozen Backbone)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="evaluating-performance">
<h3>Evaluating Performance<a class="headerlink" href="#evaluating-performance" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">val_loss_transfer</span><span class="p">,</span> <span class="n">val_acc_transfer</span> <span class="o">=</span> <span class="n">model_transfer</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">val_ds</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Transfer Learning Results (Frozen Backbone):&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;  Validation Loss: </span><span class="si">{</span><span class="n">val_loss_transfer</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;  Validation Accuracy: </span><span class="si">{</span><span class="n">val_acc_transfer</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="making-predictions">
<h3>Making Predictions<a class="headerlink" href="#making-predictions" title="Link to this heading">#</a></h3>
<p>Let’s visualize some predictions on validation images.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get predictions on one batch</span>
<span class="k">for</span> <span class="n">images</span><span class="p">,</span> <span class="n">labels</span> <span class="ow">in</span> <span class="n">val_ds</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="n">model_transfer</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">predicted_classes</span> <span class="o">=</span> <span class="n">predictions</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="c1"># Display some examples</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">images</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">))</span>
        
        <span class="n">true_class</span> <span class="o">=</span> <span class="n">class_names</span><span class="p">[</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
        <span class="n">pred_class</span> <span class="o">=</span> <span class="n">class_names</span><span class="p">[</span><span class="n">predicted_classes</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
        <span class="n">confidence</span> <span class="o">=</span> <span class="n">predictions</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">predicted_classes</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
        
        <span class="c1"># Color code: green if correct, red if wrong</span>
        <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;green&#39;</span> <span class="k">if</span> <span class="n">true_class</span> <span class="o">==</span> <span class="n">pred_class</span> <span class="k">else</span> <span class="s1">&#39;red&#39;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;True: </span><span class="si">{</span><span class="n">true_class</span><span class="si">}</span><span class="se">\n</span><span class="s1">Pred: </span><span class="si">{</span><span class="n">pred_class</span><span class="si">}</span><span class="s1"> (</span><span class="si">{</span><span class="n">confidence</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">break</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="combining-custom-cnn-with-pre-trained-features">
<h2>Combining Custom CNN with Pre-trained Features<a class="headerlink" href="#combining-custom-cnn-with-pre-trained-features" title="Link to this heading">#</a></h2>
<p>A hybrid approach uses both custom convolutional layers and pre-trained features. This is useful when:</p>
<ul class="simple">
<li><p>Your dataset has unique characteristics not well represented in ImageNet</p></li>
<li><p>You want to learn task-specific low-level features while leveraging pre-trained high-level features</p></li>
<li><p>You have sufficient data to train custom layers without overfitting</p></li>
</ul>
<section id="building-a-hybrid-model">
<h3>Building a Hybrid Model<a class="headerlink" href="#building-a-hybrid-model" title="Link to this heading">#</a></h3>
<p>We create two parallel branches:</p>
<ol class="arabic simple">
<li><p><strong>Custom CNN branch</strong>: Learns task-specific features from scratch</p></li>
<li><p><strong>Pre-trained branch</strong>: Extracts general features from ImageNet</p></li>
</ol>
<p>Then concatenate and combine both feature sets for classification.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Build hybrid model with two parallel branches</span>
<span class="n">inputs</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">image_size</span> <span class="o">+</span> <span class="p">(</span><span class="mi">3</span><span class="p">,))</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">preprocess_input</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>  <span class="c1"># Preprocess for MobileNetV2</span>

<span class="c1"># Branch 1: Custom CNN path - learns flower-specific features</span>
<span class="n">custom_branch</span> <span class="o">=</span> <span class="n">layers</span><span class="o">.</span><span class="n">Conv2D</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span>
<span class="n">custom_branch</span> <span class="o">=</span> <span class="n">layers</span><span class="o">.</span><span class="n">MaxPooling2D</span><span class="p">(</span><span class="mi">2</span><span class="p">)(</span><span class="n">custom_branch</span><span class="p">)</span>
<span class="n">custom_branch</span> <span class="o">=</span> <span class="n">layers</span><span class="o">.</span><span class="n">Conv2D</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)(</span><span class="n">custom_branch</span><span class="p">)</span>
<span class="n">custom_branch</span> <span class="o">=</span> <span class="n">layers</span><span class="o">.</span><span class="n">GlobalAveragePooling2D</span><span class="p">()(</span><span class="n">custom_branch</span><span class="p">)</span>  <span class="c1"># Reduces to 64 features</span>

<span class="c1"># Branch 2: Pre-trained features - extracts general visual features</span>
<span class="n">pretrained_branch</span> <span class="o">=</span> <span class="n">base_model</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">training</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># Keep frozen</span>
<span class="n">pretrained_branch</span> <span class="o">=</span> <span class="n">layers</span><span class="o">.</span><span class="n">GlobalAveragePooling2D</span><span class="p">()(</span><span class="n">pretrained_branch</span><span class="p">)</span>  <span class="c1"># Reduces to 1280 features</span>

<span class="c1"># Combine both branches: concatenate custom (64) + pretrained (1280) = 1344 features</span>
<span class="n">combined</span> <span class="o">=</span> <span class="n">layers</span><span class="o">.</span><span class="n">Concatenate</span><span class="p">()([</span><span class="n">custom_branch</span><span class="p">,</span> <span class="n">pretrained_branch</span><span class="p">])</span>
<span class="n">combined</span> <span class="o">=</span> <span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">)(</span><span class="n">combined</span><span class="p">)</span>  <span class="c1"># Learn feature combinations</span>
<span class="n">combined</span> <span class="o">=</span> <span class="n">layers</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)(</span><span class="n">combined</span><span class="p">)</span>  <span class="c1"># Regularization</span>
<span class="n">outputs</span> <span class="o">=</span> <span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">num_classes</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;softmax&#39;</span><span class="p">)(</span><span class="n">combined</span><span class="p">)</span>

<span class="n">model_hybrid</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;hybrid_model&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="training-the-hybrid-model">
<h3>Training the Hybrid Model<a class="headerlink" href="#training-the-hybrid-model" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_hybrid</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
    <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span>
    <span class="n">loss</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">SparseCategoricalCrossentropy</span><span class="p">(),</span>
    <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">]</span>
<span class="p">)</span>

<span class="c1"># Train hybrid model</span>
<span class="n">history_hybrid</span> <span class="o">=</span> <span class="n">model_hybrid</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
    <span class="n">train_ds</span><span class="p">,</span>
    <span class="n">validation_data</span><span class="o">=</span><span class="n">val_ds</span><span class="p">,</span>
    <span class="n">epochs</span><span class="o">=</span><span class="mi">10</span>
<span class="p">)</span>

<span class="c1"># Evaluate</span>
<span class="n">val_loss_hybrid</span><span class="p">,</span> <span class="n">val_acc_hybrid</span> <span class="o">=</span> <span class="n">model_hybrid</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">val_ds</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Hybrid Model Results:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;  Validation Loss: </span><span class="si">{</span><span class="n">val_loss_hybrid</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;  Validation Accuracy: </span><span class="si">{</span><span class="n">val_acc_hybrid</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Hybrid Model Characteristics:</strong></p>
<ul class="simple">
<li><p>Trains both custom and pre-trained pathways</p></li>
<li><p>Custom layers can learn flower-specific patterns (petal textures, colors)</p></li>
<li><p>Pre-trained features provide robust general visual understanding</p></li>
<li><p>More trainable parameters than frozen transfer learning</p></li>
<li><p>Useful when your domain has unique characteristics not in ImageNet</p></li>
</ul>
</section>
</section>
<section id="fine-tuning">
<h2>Fine-tuning<a class="headerlink" href="#fine-tuning" title="Link to this heading">#</a></h2>
<p>Fine-tuning is the second transfer learning strategy. After training the new classification head with a frozen backbone, we:</p>
<ol class="arabic simple">
<li><p><strong>Unfreeze</strong> some or all of the backbone layers</p></li>
<li><p><strong>Continue training</strong> with a <strong>much lower learning rate</strong></p></li>
<li><p>Allow the pre-trained weights to adapt slightly to our specific task</p></li>
</ol>
<section id="why-fine-tune">
<h3>Why Fine-tune?<a class="headerlink" href="#why-fine-tune" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p><strong>Better adaptation</strong>: Backbone features adjust to our specific dataset</p></li>
<li><p><strong>Higher accuracy</strong>: Often achieves better results than frozen features</p></li>
<li><p><strong>Task-specific features</strong>: Top layers learn patterns specific to flowers</p></li>
</ul>
</section>
<section id="risks-and-precautions">
<h3>Risks and Precautions<a class="headerlink" href="#risks-and-precautions" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p><strong>Catastrophic forgetting</strong>: High learning rate can destroy pre-trained knowledge</p></li>
<li><p><strong>Overfitting</strong>: More trainable parameters increase overfitting risk</p></li>
<li><p><strong>Solution</strong>: Use very small learning rate (10-100× smaller than initial training)</p></li>
</ul>
</section>
<section id="unfreezing-the-backbone">
<h3>Unfreezing the Backbone<a class="headerlink" href="#unfreezing-the-backbone" title="Link to this heading">#</a></h3>
<p>We can unfreeze:</p>
<ul class="simple">
<li><p><strong>All layers</strong>: Maximum flexibility</p></li>
<li><p><strong>Top N layers</strong>: Keeps early generic features frozen</p></li>
</ul>
<p>Let’s unfreeze the entire backbone:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Unfreeze the base model - allows weights to update during training</span>
<span class="n">base_model</span><span class="o">.</span><span class="n">trainable</span> <span class="o">=</span> <span class="kc">True</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Number of layers in base model: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">base_model</span><span class="o">.</span><span class="n">layers</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Trainable layers: </span><span class="si">{</span><span class="nb">sum</span><span class="p">([</span><span class="mi">1</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">layer</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">base_model</span><span class="o">.</span><span class="n">layers</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">layer</span><span class="o">.</span><span class="n">trainable</span><span class="p">])</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="recompiling-with-lower-learning-rate">
<h3>Recompiling with Lower Learning Rate<a class="headerlink" href="#recompiling-with-lower-learning-rate" title="Link to this heading">#</a></h3>
<p><strong>Critical:</strong> Use a much smaller learning rate for fine-tuning to avoid destroying pre-trained knowledge.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compile with very low learning rate (100× smaller than default)</span>
<span class="c1"># This prevents catastrophic forgetting of ImageNet features</span>
<span class="n">model_transfer</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
    <span class="n">optimizer</span><span class="o">=</span><span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">),</span>  <span class="c1"># Default is 1e-3</span>
    <span class="n">loss</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">SparseCategoricalCrossentropy</span><span class="p">(),</span>
    <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">]</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Model recompiled with learning rate: 1e-5&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="fine-tuning-training">
<h3>Fine-tuning Training<a class="headerlink" href="#fine-tuning-training" title="Link to this heading">#</a></h3>
<p>Continue training for a few more epochs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">epochs_finetune</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">total_epochs</span> <span class="o">=</span> <span class="n">epochs_initial</span> <span class="o">+</span> <span class="n">epochs_finetune</span>

<span class="c1"># Continue training from where we left off</span>
<span class="n">history_finetune</span> <span class="o">=</span> <span class="n">model_transfer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
    <span class="n">train_ds</span><span class="p">,</span>
    <span class="n">validation_data</span><span class="o">=</span><span class="n">val_ds</span><span class="p">,</span>
    <span class="n">epochs</span><span class="o">=</span><span class="n">total_epochs</span><span class="p">,</span>
    <span class="n">initial_epoch</span><span class="o">=</span><span class="n">history_transfer</span><span class="o">.</span><span class="n">epoch</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="visualizing-fine-tuning-results">
<h3>Visualizing Fine-tuning Results<a class="headerlink" href="#visualizing-fine-tuning-results" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_training_history</span><span class="p">(</span><span class="n">history_finetune</span><span class="p">,</span> <span class="s1">&#39;Fine-tuning&#39;</span><span class="p">)</span>

<span class="n">val_loss_finetune</span><span class="p">,</span> <span class="n">val_acc_finetune</span> <span class="o">=</span> <span class="n">model_transfer</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">val_ds</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Fine-tuning Results:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;  Validation Loss: </span><span class="si">{</span><span class="n">val_loss_finetune</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;  Validation Accuracy: </span><span class="si">{</span><span class="n">val_acc_finetune</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="combined-training-curve">
<h3>Combined Training Curve<a class="headerlink" href="#combined-training-curve" title="Link to this heading">#</a></h3>
<p>Let’s visualize the complete training process: frozen backbone + fine-tuning.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Combine histories from both training phases</span>
<span class="n">acc</span> <span class="o">=</span> <span class="n">history_transfer</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">history_finetune</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">]</span>
<span class="n">val_acc</span> <span class="o">=</span> <span class="n">history_transfer</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;val_accuracy&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">history_finetune</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;val_accuracy&#39;</span><span class="p">]</span>
<span class="n">loss</span> <span class="o">=</span> <span class="n">history_transfer</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;loss&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">history_finetune</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;loss&#39;</span><span class="p">]</span>
<span class="n">val_loss</span> <span class="o">=</span> <span class="n">history_transfer</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;val_loss&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">history_finetune</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;val_loss&#39;</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="c1"># Loss plot</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">loss</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Train Loss&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">val_loss</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Val Loss&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">epochs_initial</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Start Fine-tuning&#39;</span><span class="p">)</span>  <span class="c1"># Mark transition</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Epoch&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Loss&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Complete Training: Frozen + Fine-tuning&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># Accuracy plot</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">acc</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Train Accuracy&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">val_acc</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Val Accuracy&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">epochs_initial</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Start Fine-tuning&#39;</span><span class="p">)</span>  <span class="c1"># Mark transition</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Epoch&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Accuracy&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Complete Training: Frozen + Fine-tuning&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="comparing-approaches">
<h2>Comparing Approaches<a class="headerlink" href="#comparing-approaches" title="Link to this heading">#</a></h2>
<p>Let’s summarize the different approaches we could use:</p>
<section id="training-from-scratch-previous-notebook">
<h3>Training from Scratch (Previous Notebook)<a class="headerlink" href="#training-from-scratch-previous-notebook" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Train all weights randomly initialized</p></li>
<li><p>Requires more data and epochs</p></li>
<li><p>Higher computational cost</p></li>
</ul>
</section>
<section id="transfer-learning-frozen">
<h3>Transfer Learning (Frozen)<a class="headerlink" href="#transfer-learning-frozen" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Freeze pre-trained backbone</p></li>
<li><p>Train only new classification layers</p></li>
<li><p>Fast training, good baseline results</p></li>
</ul>
</section>
<section id="hybrid-model">
<h3>Hybrid Model<a class="headerlink" href="#hybrid-model" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Combines custom CNN with pre-trained features</p></li>
<li><p>Learns task-specific features while leveraging ImageNet knowledge</p></li>
<li><p>More parameters than frozen, less than full fine-tuning</p></li>
</ul>
</section>
<section id="id1">
<h3>Fine-tuning<a class="headerlink" href="#id1" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Start with frozen backbone training</p></li>
<li><p>Then unfreeze and train with low learning rate</p></li>
<li><p>Best accuracy, moderate training time</p></li>
</ul>
</section>
<section id="comparison-table">
<h3>Comparison Table<a class="headerlink" href="#comparison-table" title="Link to this heading">#</a></h3>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Approach</p></th>
<th class="head"><p>Trainable Params</p></th>
<th class="head"><p>Training Time</p></th>
<th class="head"><p>Typical Accuracy</p></th>
<th class="head"><p>When to Use</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>From scratch (Notebook 05)</p></td>
<td><p>All (~500K-2M)</p></td>
<td><p>Slow</p></td>
<td><p>Baseline</p></td>
<td><p>Large dataset, unique domain</p></td>
</tr>
<tr class="row-odd"><td><p>Frozen backbone</p></td>
<td><p>Few (~10K-50K)</p></td>
<td><p>Fast</p></td>
<td><p>Good</p></td>
<td><p>Limited data, similar to ImageNet</p></td>
</tr>
<tr class="row-even"><td><p>Hybrid model</p></td>
<td><p>Medium (~50K-200K)</p></td>
<td><p>Medium</p></td>
<td><p>Good-Better</p></td>
<td><p>Dataset with unique characteristics</p></td>
</tr>
<tr class="row-odd"><td><p>Fine-tuning</p></td>
<td><p>All (~500K-3M)</p></td>
<td><p>Medium</p></td>
<td><p>Best</p></td>
<td><p>Want highest accuracy, have some data</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="performance-summary">
<h3>Performance Summary<a class="headerlink" href="#performance-summary" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Performance Comparison:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Transfer Learning (Frozen):  </span><span class="si">{</span><span class="n">val_acc_transfer</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Hybrid Model:                </span><span class="si">{</span><span class="n">val_acc_hybrid</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fine-tuning:                 </span><span class="si">{</span><span class="n">val_acc_finetune</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Improvement from fine-tuning: </span><span class="si">{</span><span class="p">(</span><span class="n">val_acc_finetune</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">val_acc_transfer</span><span class="p">)</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Typical observations:</strong></p>
<ul class="simple">
<li><p>Transfer learning achieves good results quickly (70-80% accuracy in 10 epochs)</p></li>
<li><p>Hybrid models can match or exceed frozen transfer learning</p></li>
<li><p>Fine-tuning usually improves accuracy by 2-5%</p></li>
<li><p>All approaches vastly outperform training from scratch with limited data</p></li>
</ul>
</section>
</section>
<section id="recap">
<h2>Recap<a class="headerlink" href="#recap" title="Link to this heading">#</a></h2>
<p><strong>Transfer Learning Concept:</strong></p>
<ul class="simple">
<li><p>Reuse knowledge from models trained on large datasets (ImageNet with 1.4M images)</p></li>
<li><p>Reduces data requirements and training time significantly</p></li>
<li><p>Often achieves better results than training from scratch, especially with limited data</p></li>
</ul>
<p><strong>Pre-trained Models:</strong></p>
<ul class="simple">
<li><p>Keras Applications provides many CNN architectures (MobileNetV2, EfficientNet, ResNet)</p></li>
<li><p>Models pre-trained on ImageNet (1000 classes: animals, plants, objects)</p></li>
<li><p>Different models offer tradeoffs: MobileNetV2 (fast), ResNet50 (accurate), EfficientNet (balanced)</p></li>
</ul>
<p><strong>Model-Specific Preprocessing:</strong></p>
<ul class="simple">
<li><p>Each pre-trained model expects specific input format</p></li>
<li><p>Always use model’s preprocessing function (e.g., <code class="docutils literal notranslate"><span class="pre">mobilenet_v2.preprocess_input</span></code>)</p></li>
<li><p>MobileNetV2 scales to [-1, 1], ResNet subtracts mean, EfficientNet normalizes</p></li>
</ul>
<p><strong>Feature Extraction:</strong></p>
<ul class="simple">
<li><p>Freeze pre-trained backbone (<code class="docutils literal notranslate"><span class="pre">trainable=False</span></code>)</p></li>
<li><p>Train only new classification layers</p></li>
<li><p>Fast training, provides good baseline performance</p></li>
</ul>
<p><strong>Hybrid Approach:</strong></p>
<ul class="simple">
<li><p>Combine custom CNN branch with pre-trained features</p></li>
<li><p>Learn task-specific patterns while leveraging ImageNet knowledge</p></li>
<li><p>Useful when dataset has unique characteristics</p></li>
</ul>
<p><strong>Fine-tuning:</strong></p>
<ul class="simple">
<li><p>Unfreeze backbone after initial training with frozen weights</p></li>
<li><p>Continue training with very low learning rate (e.g., 1e-5 vs default 1e-3)</p></li>
<li><p>Allows weights to adapt to specific task without forgetting ImageNet features</p></li>
<li><p>Usually improves accuracy by 2-5% over frozen features</p></li>
</ul>
<p><strong>Best Practices:</strong></p>
<ul class="simple">
<li><p>Always start with frozen backbone training</p></li>
<li><p>Use correct preprocessing for chosen backbone</p></li>
<li><p>Use very low learning rate for fine-tuning (100× smaller)</p></li>
<li><p>Monitor validation metrics to avoid overfitting</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="05_cnn_theory_keras.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">CNN Theory and Implementation with Keras</p>
      </div>
    </a>
    <a class="right-next"
       href="07_cv_tasks_theory.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">07 - Computer Vision Tasks: Theory and Concepts</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#table-of-contents">Table of Contents</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setup-and-data-preparation">Setup and Data Preparation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-the-flowers-dataset">Loading the Flowers Dataset</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#creating-datasets">Creating Datasets</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dataset-performance-optimization">Dataset Performance Optimization</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-transfer-learning">What is Transfer Learning?</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-core-idea">The Core Idea</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#key-benefits">Key Benefits</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#when-does-transfer-learning-work">When Does Transfer Learning Work?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#two-main-strategies">Two Main Strategies</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pre-trained-models-in-keras">Pre-trained Models in Keras</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#available-models">Available Models</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mobilenetv2">MobileNetV2</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#imagenet-pre-training">ImageNet Pre-training</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-extraction-with-frozen-backbone">Feature Extraction with Frozen Backbone</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-the-pre-trained-model">Loading the Pre-trained Model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#freezing-the-backbone">Freezing the Backbone</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#understanding-model-specific-preprocessing">Understanding Model-Specific Preprocessing</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#building-the-transfer-learning-model">Building the Transfer Learning Model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#model-summary">Model Summary</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#training-the-model">Training the Model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-results">Visualizing Results</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#evaluating-performance">Evaluating Performance</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#making-predictions">Making Predictions</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#combining-custom-cnn-with-pre-trained-features">Combining Custom CNN with Pre-trained Features</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#building-a-hybrid-model">Building a Hybrid Model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#training-the-hybrid-model">Training the Hybrid Model</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fine-tuning">Fine-tuning</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#why-fine-tune">Why Fine-tune?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#risks-and-precautions">Risks and Precautions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#unfreezing-the-backbone">Unfreezing the Backbone</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#recompiling-with-lower-learning-rate">Recompiling with Lower Learning Rate</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fine-tuning-training">Fine-tuning Training</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-fine-tuning-results">Visualizing Fine-tuning Results</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#combined-training-curve">Combined Training Curve</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#comparing-approaches">Comparing Approaches</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#training-from-scratch-previous-notebook">Training from Scratch (Previous Notebook)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#transfer-learning-frozen">Transfer Learning (Frozen)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hybrid-model">Hybrid Model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Fine-tuning</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#comparison-table">Comparison Table</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#performance-summary">Performance Summary</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#recap">Recap</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By The Jupyter Book community
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>